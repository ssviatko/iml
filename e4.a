	!to "e4.o",plain
	!cpu 65816

	*= $e400

	!align $ffff,$e400	;leave room for softswitches

IO_CON_CLS = $1bfc10
IO_CON_CHAROUT = $1bfc12
IO_CON_REGISTER = $1bfc13

romstart
	clc
	xce
	rep #$30
	!rl
	!al
	lda #$0000
	pha
	plb
	plb
	tcd
	ldx #$e3ff
	txs
	sep #20
	!as
	sta IO_CON_CLS
	ldx #$0000
prloop
	lda initstring, X
	beq done
	sta IO_CON_CHAROUT
	sta IO_CON_REGISTER
	inx
	bra prloop
done
	stp

initstring
	!tx "IML 65816 E4 Firmware v00"
	!byte 0x0d
	!byte 0x0d
	!tx "By Stephen Sviatko, 09/2024"
	!byte 0x0d
	!byte 0x0d
	!byte 0

	!align $ffff,$fffc,$00

reset	!word romstart
irq	!word romstart
 
